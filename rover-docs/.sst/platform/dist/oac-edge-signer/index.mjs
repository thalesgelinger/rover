import { createRequire as topLevelCreateRequire } from 'module';const require = topLevelCreateRequire(import.meta.url);
import a from"node:crypto";var d=async t=>{let e=t.Records[0].cf.request;if(!["POST","PUT","PATCH","DELETE"].includes(e.method))return e;if(e.body?.inputTruncated)return{status:"413",statusDescription:"Payload Too Large",headers:{"content-type":[{key:"Content-Type",value:"application/json"}]},body:JSON.stringify({error:"Request body exceeds 1MB Lambda@Edge limit. Use presigned S3 URLs for large uploads."})};try{let o=e.body?.data?e.body.encoding==="base64"?Buffer.from(e.body.data,"base64"):Buffer.from(e.body.data):Buffer.alloc(0),r=a.createHash("sha256").update(o).digest("hex");e.headers["x-amz-content-sha256"]=[{key:"x-amz-content-sha256",value:r}],console.log(`Added SHA256 header for ${e.method} request to ${e.uri}: ${r}`)}catch(o){console.error("Error computing SHA256 hash:",o)}return e};export{d as handler};
